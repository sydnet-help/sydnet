---
title: "SOC830 Lab 6: Univariate Statistics 2"

lastmod: 2018-12-28T00:00:00.000Z

draft: false
type: docs
maths: true

output:
  blogdown::html_page:
    toc: true

linktitle: "Lab 6: Univariate Statistics 2"
menu:
  docs:
    parent: SOC830(SOCI702)
    weight: 35
---
The sixth lab session covers the following:

* How to compute percentiles
* How to calculate descriptive statistics for sub-groups
* How to visualise the distribution for multiple variables and sub-groups
* How to include R outputs in your Word document

We will use five packages for this lab. Load them using the following code:

```{r eval=TRUE, echo=FALSE, include=FALSE}
library(dplyr)
library(sjlabelled)
library(sjmisc)
library(sjPlot)
library(summarytools)
```

```{r eval=FALSE, echo=TRUE}
library(dplyr)
library(sjlabelled)
library(sjmisc)
library(sjPlot)
library(summarytools)
```

# Import the 2012 AuSSa dataset.
This lab uses the 2012 AuSSa dataset. You can download the file of this dataset in the course website(iLearn). Download the data file and put it in your working directory. Then, run the following code: 

```{r, echo=FALSE}
aus2012 <- readRDS(url("https://github.com/hylee87/surveyclass/raw/master/data/aussa2012.rds"))
```
```{r eval=FALSE, echo=TRUE}
aus2012 <-readRDS("aussa2012.rds")
```

The dataset is loaded as _aus2012_.

# How to compute percentiles
A percentile is a statistical measure indicating that the value below which a given percentage of cases (or observations) falls. . ‘`quantile(data name$variable name, c(pct1, pct2, pct3,…), na.rm = TRUE)`’ computes the percentiles of variables of your choice. Percentile values (e.g., `pct1`, `pct2`) should be entered as proportions. For example, when you want to calculate the 10th percentile, you should input .10. ‘`na.rm = TRUE`’ excludes cases with missing values (NA) in calculating the percentile. The following code computes 10th, 25th, 50th, 75th and 90th percentile of _age_ in _aus2012_.

```{r, echo=TRUE}
quantile(aus2012$age, c(.10, .25, .50, .75, .90), na.rm = TRUE)
```

# How to calculate descriptive statistics for sub-groups
In lab 5 I showed how to compute descriptive statistics for all respondents. However, we sometimes need to calculate them for sub-groups such as only male or female respondents. This kind of analysis is called sub-group analysis. This section focuses on how to conduct this sub-group analysis.

## Creating a dataset of a sub-group
We will make a new dataset called _aus2012.m_ which includes only male respondents. Run the following code:

```{r, echo=TRUE}
aus2012.m <- aus2012 %>%
  filter(sex == 1)
frq(aus2012.m$sex)
```

The first line assigns a new dataset name before the arrow (<-) and the name of the dataset from which the new dataset is extracted after the arrow. The second line specifies selection criteria. Use ‘`filter(selection criteria)`’. In this case, we select cases in which respondents are males (sex == 1). Note that we use two equal signs (==), which is a logical operator meaning “exactly equal to”. Table 1 shows logical operators.

The third line generates a frequency table of gender for the new dataset. As expected, it only includes male respondents.

```{r, echo=FALSE, include=FALSE}
library(kableExtra)
```

```{r, echo=FALSE}
col1 <- c("<", "<=", ">", ">=", "==", "!=", "!x", "x | y", "x & y")
col2 <- c("less than", "less than or equal to", "greater than", "greater than or equal to",
          "exactly equal to", "not equal to", "Not x", "x OR y", "x AND y")
tab1 <- cbind(col1, col2)
tab1 <- as.data.frame(tab1)
kable(tab1, "latex", booktabs = T, caption = "Logical Operators", 
      col.names = c("Operator", "Description"), align = "c")
```

The following code creates a dataset which includes only female respondents.

```{r, echo=TRUE}
aus2012.f <- aus2012 %>%
  filter(sex == 2)
frq(aus2012.f$sex)
```

When you select cases, you can specify multiple criteria. For example, the following code generates a dataset which includes male respondents who live in NSW (_region_ == 1).

```{r, echo=TRUE}
aus2012.m.nsw <- aus2012 %>%
  filter(sex == 1, region == 1)
frq(aus2012.m.nsw$sex)
frq(aus2012.m.nsw$region)
```

## Creating a dataset of specific variables
This time we will make a dataset which includes only variables of your choice. Suppose that we want to make a dataset which includes only variables measuring attitudes toward working mom in the 2012 AuSSa. The following code will do this job.

```{r, echo=TRUE}
aus2012.working.mom <- aus2012 %>%
  select("fechld", "fepresch", "famsuffr", "homekid", "housewrk")
aus2012.working.mom
```

There is only one difference in this code from what you used for selecting cases. ‘`select(var1, var2, var3, …)`’ is the function for choosing variables of your choice. The third line shows the newly created dataset.

## Frequency tables for sub-groups
Based on the codes you have learned so far, let us make a frequency table of _fechld_ for only male respondents. The following code will do this job.

```{r, echo=TRUE}
aus2012 %>%
  filter(sex == 1) %>%
  select(fechld) %>%
  frq()
```

What this code does is 1) to use the aus2012 dataset, and then (%>%) 2) to select cases where respondents are males, and then 3) to choose the _fechld_ variable, and then 4) to make a frequency table.
When you want to use ‘`freq()`’ instead of '`frq()`' for making frequency tables, a different approach should be used since the _summarytools_ package does not support labelled datasets. We need to use the dataset of male respondents that we created in the previous section. The code is:

```{r, echo=TRUE}
freq(to_label(aus2012.m$fechld))
```

The following code generates a frequency table of _fechld_ for female respondents.

```{r, echo=TRUE}
aus2012 %>%
  filter(sex == 2) %>%
  select(fechld) %>%
  frq()
freq(to_label(aus2012.f$fechld))
```

## Descriptive statiscs for sub-groups
The code for calculating descriptive statistics for sub-groups is similar to that for frequency tables. The only difference is to use ‘`descr()`’ instead of ‘`frq()`’. The following code computes descriptive statistics of _age_ for male and female respondents, respectively.

```{r, echo=TRUE}
aus2012 %>%
  filter(sex == 1) %>%
  select(age) %>%
  descr()

aus2012 %>%
  filter(sex == 2) %>%
  select(age) %>%
  descr()
```

# How to visualise the distributions for multiple variables and sub-groups
In lab 5 we learned how to visualise the distribution of one variable. Building on this knowledge, this lab introduces how to visualise the distribution for multiple variables and sub-groups.

## Stacked bar graphs for multiple variables
Suppose that we want to visualise all the variables of attitudes toward working moms so that we can easily compare the distributions. For doing this, we need to create a dataset consisting of all variables we want to visualise. We already made this dataset in the previous section, which is _aus2012.working.mom_. The following code visualises all the five variables of attitudes toward working moms.

```{r, echo=TRUE, fig.height=5, fig.width=12}
sjp.stackfrq(aus2012.working.mom,
             title = "Attitude toward working mom") 
```

If you want to flip coordinates of stacked bar graphs, add ‘`coord.flip = FALSE`’ to the option. In the following code, I also add ‘`wrap.labels = 20`’ to avoid the overlap between labels.

```{r, echo=TRUE, fig.height=5, fig.width=10}
sjp.stackfrq(aus2012.working.mom,
             title = "Attitude toward working mom", 
             wrap.labels = 20, coord.flip = FALSE) 
```

## Stacked bar graphs for multiple Likert scales
‘`plot_likert()`’ is a function specifically designed for visualising Likert scales. Since all the variables of attitudes toward working moms use Likert scales, it would be better to visualise them using this function. The code is:

```{r, echo=TRUE, fig.height=5, fig.width=12}
plot_likert(aus2012.working.mom,
           cat.neutral = 3, title = "Attitude toward working mom") 
```

## Grouped stacked bar graphs
This time we visualise the distribution of one variable but do it by different groups. Suppose that we want to compare the distribution of _fechld_ between men and women. ‘`sjp.xtab(grouping variable, the name of variable to be compared, bar.pos = “stack”)`’ make this job easier. The following code shows the grouped stacked bar graph of _fechld_ by _sex_.

```{r, echo=TRUE, fig.height=5, fig.width=10}
sjp.xtab(aus2012$sex, aus2012$fechld, bar.pos = "stack", show.total = FALSE,
         margin = "row", coord.flip = TRUE, show.n = FALSE) 
```

The margin option sets how percentages are calculated. ‘`margin = “row”`’ computes the percentages of responses for each group.

## Simple boxplots
When you want to make a boxplot of one variable, use ‘`sjp.frq(variable name, type = “box”)`’.  The following code makes a boxplot of age in the aus2012 dataset.

```{r, echo=TRUE}
sjp.frq(aus2012$age, type = "box", axis.title = "Respondent's Age")
```

## Grouped boxplots
When you want to make the boxplot of one variable by different groups, use ‘`sjpgrp.frq(the name of variable to be compared, grouping variable, type = “box”)`'. The following code creates the boxplots of _age_ by _sex_.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
sjp.grpfrq(aus2012$age, aus2012$sex, type = "box", 
           axis.title = "Respondent's Age",  ylim = c(0, 100))
```

‘`ylim = c(minimum value, maximum value)`’ sets the range of y-axis. As instructed, the y-axis ranges from 0 to 100.

---

<span style="color:navy">**Note**</span> 

You may see a warning message saying <span style="color:red">"_Package 'snakecase' needs to be installed for case-conversion_"</span> when you try to make a grouped boxplot. To fix this problem, run the following code.

```{r eval=FALSE, echo=TRUE}
install.packages("snakecase")
```

Or you may see a warning message saying <span style="color:red">"_there is no pacakge called 'quantreg'_"</span>. In this case run the following code.

```{r eval=FALSE, echo=TRUE}
install.packages("quantreg")
```

Then, restart RStudio, load all the packages again and make a grouped boxplot. 

---

## Histograms for different groups
There is no simple code to generate the histograms of one variable by groups.  Thus, we need to create datasets for each group and use them for visualisation. Suppose that we want to plot the histogram of age for male and female respondents, respectively. We use _aus2012.m_ which includes only males and _aus2012.f_ which includes only females that we constructed in the previous section. The following code generates these two histograms.

```{r, echo=TRUE}
sjp.frq(aus2012.m$age, type = "hist", title = "Distribution of Age for Males", 
  axis.title = "Age", grid.breaks = 10)
sjp.frq(aus2012.f$age, type = "hist", title = "Distribution of Age for Females", 
  axis.title = "Age", grid.breaks = 10)
```

# How to include R outputs in your document
The lab assignment requires you to include relevant R outputs in your documents. This section introduces how to include them in an MS Word document.

## How to include R outputs from the window of Console
When you want to include R outputs from the window of **Console** (e.g., frequency tables, descriptive statistics), select the output you want to include and then right-click. You will see the copy option. Choose it (See Figure 1).

```{r, echo=FALSE, fig.cap="Copy from R Console", fig.align='center'}
knitr::include_graphics("/img/SOC830_lab06_01.png")
```

Open MS Word and right-click. In the paste option, choose “Keep Source Formatting”. 

```{r, echo=FALSE, fig.cap="Import R Outputs into MS Word", fig.align='center'}
knitr::include_graphics("/img/SOC830_lab06_02.png")
```

## How to include R graphs from the window of Plots
When you want to include R outputs from the window of **Plots** (all kinds of graphs), click **Export** at the top of the **Plots** window and choose “Copy to Clipboard” (See Figure 3).

```{r, echo=FALSE, fig.cap="Copy from R Plots", fig.align='center'}
knitr::include_graphics("/img/SOC830_lab06_03.png")
```

In a popped-up window, click “Copy Plot” at the bottom. If you do not like the size of graphs, you can change it either by 1) specifying the width and height at the top (then click “Update Preview”) or 2) moving the bottom-right triangle while pressing down the right button of the mouse (See Figure 4).

```{r, echo=FALSE, fig.cap="Import R Graphs into MS Word", fig.align='center'}
knitr::include_graphics("/img/SOC830_lab06_04.png")
```

Then, paste the graph into a MS Word document.

The R codes you have written so far look like:

```{r eval=FALSE, echo=TRUE}
################################################################################
# Week7: Univariate Analysis 2 & Normal Distribution
# 08/04/2019
# SOC830, SOCI702, SOCX830
################################################################################

# Load packages
library(dplyr)
library(sjlabelled)
library(sjmisc)
library(sjPlot)
library(summarytools)

# Import the 2012 AuSSa dataset.
aus2012 <-readRDS("aussa2012.rds")

# How to compute percentiles
## .10: 10%; .25: 25%; .50: 50%; .75: 75%; .90: 90%
## na.rm = TRUE : exclude missing values (NA)
quantile(aus2012$age, c(.10, .25, .50, .75, .90), na.rm = TRUE)

# Creating a dataset of a sub-group
aus2012.m <- aus2012 %>%
  filter(sex == 1)
frq(aus2012.m$sex)

aus2012.f <- aus2012 %>%
  filter(sex == 2)
frq(aus2012.f$sex)

aus2012.m.nsw <- aus2012 %>%
  filter(sex == 1, region == 1)
frq(aus2012.m.nsw$sex)
frq(aus2012.m.nsw$region)

# Creating a dataset of specific variables
aus2012.working.mom <- aus2012 %>%
  select("fechld", "fepresch", "famsuffr", "homekid", "housewrk")
aus2012.working.mom

# Frequency tables for sub-groups
aus2012 %>%
  filter(sex == 1) %>%
  select(fechld) %>%
  frq() # for males


freq(to_label(aus2012.m$fechld))

aus2012 %>%
  filter(sex == 2) %>%
  select(fechld) %>%
  frq()
freq(to_label(aus2012.f$fechld))

# Descriptive statistics for sub-groups
aus2012 %>%
  filter(sex == 1) %>%
  select(age) %>%
  descr() # for males

aus2012 %>%
  filter(sex == 2) %>%
  select(age) %>%
  descr() # for females

# Stacked bar graphs for multiple variables
sjp.stackfrq(aus2012.working.mom,
             title = "Attitude toward working mom") 
sjp.stackfrq(aus2012.working.mom,
             title = "Attitude toward working mom", 
             wrap.labels = 20, coord.flip = FALSE) 

# Stacked bar graphs for likert scale
plot_likert(aus2012.working.mom,
           cat.neutral = 3, title = "Attitude toward working mom") 

# Grouped stacked bar graphs
sjp.xtab(aus2012$sex, aus2012$fechld, bar.pos = "stack", show.total = FALSE,
         margin = "row", coord.flip = TRUE, show.n = FALSE)

# Simple boxplots
sjp.frq(aus2012$age, type = "box", axis.title = "Respondent's Age")

# Grouped boxplots
sjp.grpfrq(aus2012$age, aus2012$sex, type = "box", 
           axis.title = "Respondent's Age", ylim = c(0, 100))


# Histograms for different groups
sjp.frq(aus2012.m$age, type = "hist", title = "Distribution of Age for Males", 
  axis.title = "Age", grid.breaks = 10)
sjp.frq(aus2012.f$age, type = "hist", title = "Distribution of Age for Females", 
  axis.title = "Age", grid.breaks = 10)
```

<center>
Last updated on _`r format(Sys.time(), '%d %B, %Y')`_ by _Dr Hang Young Lee_[(hangyoung.lee@mq.edu.au)](mailto:hangyoung.lee@mq.edu.au)
</center>
